<?xml version="1.0" encoding="UTF-8"?>
<sequence name="id_schema_validation_seq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
<validate >
        <schema key="conf:/json/id_schema_validator.json"/>
        <on-fail>
            <property name="ERROR_MESSAGE" expression="get-property('ERROR_MESSAGE')" scope="default"/>
            <property name="ERROR_DETAIL" expression="get-property('ERROR_DETAIL')" scope="default"/>
            <payloadFactory media-type="json">
                <format>
                    {
                        "error": {
                            "message": "$1",
                            "detail": "$2"
                        }
                    }
                </format>
                <args>
                    <arg expression="get-property('ERROR_MESSAGE')"/>
                    <arg expression="get-property('ERROR_DETAIL')"/>
                </args>
            </payloadFactory>
            <property name="HTTP_SC" value="500" scope="axis2"/>
            <respond/>
        </on-fail>
    </validate>
</sequence>